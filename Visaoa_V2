#include <iostream>
#include <vector>
#include <queue>

using namespace std;

int dx[4]={-1,1,0,0};
int dy[4]={0,0,-1,1};

int main(){
    int n, m;
    cin>>n>>m;
vector<vector<int>> grid(
    n + 2,                   // number of rows
    vector<int>(m + 2, 0)     // one full row
);
vector<vector<int>> fixed(
    n + 2,                   // number of rows
    vector<int>(m + 2, 0)     // one full row
);

for (int i =1; i <= n; i++) {
    for (int j = 1; j <= m; j++) {
        cin>>grid[i][j];
    }
}



for( int i=1;i<=n;i++){
    for(int j=1;j<=m;j++){
        int u = grid[i][j];
        int cnt=0;
        if(u == grid[i-1][j]){//above cell
            cnt++;
        }
        if(u == grid[i+1][j]){//below cell
            cnt++;
        }
        if(u == grid[i][j-1]){//left cell
            cnt++;
        }
        if(u == grid[i][j+1]){//right cell
            cnt++;
        }
        if (cnt>=2){
            fixed[i][j]=1;
        }
    }
}

queue<pair<int,int>> q;
for(int i =1;i<=n;i++){
    for(int j=1;j<=m;j++){
        if(fixed[i][j]==1){
            q.push({i,j});
        }
    }
}//pushing all fixed cells into BFS queue
while(!q.empty()){
    auto [x,y] = q.front();
    q.pop();
    for(int d =0 ;d<4;d++){//for all 4 directionns
        int nx = x+ dx[d];//neighbour cells
        int ny = y + dy[d];
        if(nx <1 || nx>n || ny<1 || ny >m){
            continue; 
        }
         if ( fixed[nx][ny]){
            continue; //already fixed
         }
         if (grid[nx][ny] == grid[x][y]) {
             fixed[nx][ny] = 1;
             q.push({nx, ny});
         }
    }
}
//remove such fixed cells from grid (special cells)
for(int i =1;i<=n;i++){
    for(int j =1; j<=m ; j++){
        cout<<fixed[i][j]<<" ";
        if(fixed[i][j]){
            grid[i][j]=0;
        }
    }
    cout <<"\n";
}
cout<<"\n";

//Applying gravity
for(int j =1 ; j<=m ;j++){
    vector<int> temp;
    for(int i = n; i>=1;i--){
        if(grid[i][j] >0){
            temp.push_back(grid[i][j]);
        }
        grid[i][j]=0;
    }

    int idx =0;
     for(int i =n ;i>=1;i--){
        if(idx < temp.size()){
            grid[i][j]= temp[idx];
            idx++;
        }
     }
}


for (int i =1 ;i<=n;i++){
    for(int j =1;j<=m;j++){
        cout<<grid[i][j]<<" ";
    }
    cout<<"\n";
}
return 0;
}
